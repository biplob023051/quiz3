function formatSubjectClass(e,t){if(0==e.val())if(e.is(":checked"))i=$('input[type="checkbox"][name="'+t+'\\[\\]"]').map(function(){return this.value}).get();else var i=Array();else(i=$('input[type="checkbox"][name="'+t+'\\[\\]"]:checked').map(function(){return this.value}).get()).length>0&&0==i[0]&&i.splice(0,1);return i}function updateQuiz(e,t,i){$.ajax({dataType:"json",url:projectBaseUrl+"quizzes/ajaxQuizUpdate/"+c_quiz_id,type:"post",data:{field:e,value:t},success:function(e){if(e.success&&i){i.attr("data-current-value",t);var n=i.css("background-color"),o=i.css("color");i.animate({"background-color":"#5cb85c",color:"white"}),setTimeout(function(){i.animate({"background-color":n,color:o})},1e3)}}})}function checkSize(){var e=$(window);e.width()<975||screen.width>1920&&e.width()<977?$("#QuestionExplanation").closest(".row").children().css({marginTop:"0px"}):$("#QuestionExplanation").closest(".row").children().css({marginTop:"-47px"})}var debugVar,uploadObj,window_width=$(window).width();!function(e){e(document).on("click","#upload",function(){e(this).addClass("active"),e("#from-web").removeClass("active"),e("#web-panel").hide(),e("#upload-panel").show(),uploadObj=e("#fileuploader").html("").uploadFile({url:projectBaseUrl+"upload/photo",fileName:"myfile",acceptFiles:"image/*",showPreview:!0,multiple:!1,previewHeight:"150px",previewWidth:"150px",showProgress:!0,dragDropStr:"<span class='upload-drag-drop'>"+lang_strings.drag_drop+"</span>",uploadStr:lang_strings.upload,onSelect:function(t){return e("#fileuploader").hide(),e("#upload").hide(),e("#from-web").hide(),!0},onSuccess:function(t,i,n,o){(i=e.parseJSON(i)).success?(e(".ajax-file-upload-progress").hide(),e(".ajax-file-upload-statusbar").prepend('<button data-img="'+i.filename+'" type="button" class="btn btn-default" id="file-delete-button" title="Delete image"><i class="glyphicon close"></i></button>'),e("#web-panel").find("input").val(projectBaseUrl+"uploads/questions/"+i.filename)):window.location.reload()},onError:function(t,i,n,o){e("#fileuploader").show(),e("#upload").show(),e("#from-web").show()}})}),e(document).on("click","#file-delete-button",function(t){t.preventDefault();var i=e(this).attr("data-img");e("#fileuploader").show(),e("#upload").show(),e("#from-web").show(),e("#web-panel").find("input").val(""),e(".ajax-file-upload-statusbar").remove(),e.post(projectBaseUrl+"upload/delete_photo",{image:i},function(e){}),uploadObj.reset()}),e(document).on("click","#file-delete-existing",function(t){t.preventDefault();e(this).attr("data-img");e("#upload").show(),e("#from-web").show(),e("#web-panel").find("input").val(""),e("#preview-panel").remove(),e("#upload").trigger("click")}),e(document).on("click","#from-web",function(){e(this).addClass("active"),e("#upload").removeClass("active"),e("#web-panel").show(),e("#upload-panel").hide()});var t=e.parseJSON(e("#app-data").text()),i={quizId:t.quizId,baseUrl:t.baseUrl,questionTypes:t.questionTypes};webQuiz.init(i),initial?webQuiz.addNewQuestion(!0):no_question?webQuiz.addNewQuestion(!0):webQuiz.addNewQuestion(),e(document).on("click","#questions button.add-choice",function(){var t=e(this).parent().parent().parent().attr("id"),i=e("#"+t).find("div.choices");webQuiz.addChoice(parseInt(t.substr(1,t.length-1)),i)}),e("#questions button.add-choice").trigger("click"),e(document).on("change","#questions select.choice-type-selector",function(){e("#QuestionExplanation").closest(".row").children().css({marginTop:"0px"});var t=e(this),i=t.attr("id");-1==(i=i.substr(3,i.length-1))||1!=e(this).val()&&3!=e(this).val()?-1!=i&&6!=t.val()&&editing_q_type==t.val()?webQuiz.getExistingQuestionDataRest(i,t.val()):(webQuiz.changeChoiceType(parseInt(i),t.val(),e("#q"+i).find("button.add-choice")),1!=e(this).val()&&3!=e(this).val()||e("#questions button.add-choice").trigger("click"),webQuiz.questionOptions(e(this).val()),webQuiz.additionalSettings(t.val())):webQuiz.getExistingQuestionData(i,t.val())}),e(document).on("click","#questions tr td div.preview-btn button.edit-question",function(){e("#QuestionExplanation").closest(".row").children().css({marginTop:"0px"});var t=!1;""==e("#QuestionText").val()&&(t=!0);var i=e(this).attr("id"),n=parseInt(e(this).attr("id").substr(6,i.length-1));1==t?webQuiz.setToPreview(webQuiz.currentEditQid,e("#q"+webQuiz.currentEditQid),function(t){webQuiz.setToEdit(n,e("#q"+n),function(t){var i=e("#q"+n);i.find("select.choice-type-selector").val(t.value.QuestionType.id),webQuiz.getQuestionType(t.value.QuestionType.id).value.QuestionType.multiple_choices||i.find("button.add-choice").hide(),7==t.value.QuestionType.id||8==t.value.QuestionType.id?e("#QuestionText").parent().hide():e("#QuestionText").parent().show(),webQuiz.questionOptions(t.value.QuestionType.id),6==t.value.QuestionType.id?e("#QuestionExplanation").closest(".row").hide():e("#QuestionExplanation").closest(".row").show(),7==t.value.QuestionType.id?(e("#QuestionExplanation").attr("placeholder",lang_strings.youtube_exp_text),window_width>975&&e("#QuestionExplanation").closest(".row").children().css({marginTop:"-47px"})):8==t.value.QuestionType.id?(e("#QuestionExplanation").attr("placeholder",lang_strings.image_exp_text),window_width>975&&e("#QuestionExplanation").closest(".row").children().css({marginTop:"-47px"}),e("#from-web").hide(),e("#upload").hide()):e("#QuestionExplanation").attr("placeholder",lang_strings.other_exp_text),editing_q_type=t.value.QuestionType.id}),e("#q"+n).show(),webQuiz.lastEditQid=t.question_id,webQuiz.currentEditQid=n,webQuiz.choiceSortable()},"questions/setPreview/"):webQuiz.setToPreview(webQuiz.currentEditQid,e("#q"+webQuiz.currentEditQid),function(t){webQuiz.setToEdit(n,e("#q"+n),function(t){var i=e("#q"+n);i.find("select.choice-type-selector").val(t.value.QuestionType.id),webQuiz.getQuestionType(t.value.QuestionType.id).value.QuestionType.multiple_choices||i.find("button.add-choice").hide(),7==t.value.QuestionType.id||8==t.value.QuestionType.id?e("#QuestionText").parent().hide():e("#QuestionText").parent().show(),webQuiz.questionOptions(t.value.QuestionType.id),6==t.value.QuestionType.id?e("#QuestionExplanation").closest(".row").hide():e("#QuestionExplanation").closest(".row").show(),8==t.value.QuestionType.id&&(e("#QuestionExplanation").attr("placeholder",lang_strings.image_exp_text),e("#QuestionExplanation").closest(".row").children().css({marginTop:"-47px"}))}),e("#q"+n).show(),webQuiz.lastEditQid=t.question_id,webQuiz.currentEditQid=n,webQuiz.choiceSortable()})}),e(document).on("click",".cancel-add",function(t){e("#q-1").remove(),webQuiz.addNewQuestion(),e("#questions button.add-choice").trigger("click")}),e(document).on("click","#add-question",function(t){if(!e("#q-1").is(":visible"))return e("#q-1 .cancel-add").show(),void e("#q-1").show();var i=e("#questions tbody").children("tr:not(.others_type)").length,n=e("#questions select.choice-type-selector").val();e("#q-1");if(7==n||8==n||""!=e("#QuestionText").val()){if(0==webQuiz.dataValidation(n)){if(webQuiz.addNewQuestion(!0),7!=n&&8!=n&&""==e("#QuestionText").val())return e("#q-1").remove(),void e("#questions button.add-choice").trigger("click");webQuiz.setToPreview(webQuiz.lastEditQid,e("#q"+webQuiz.lastEditQid),"test","questions/save/",i);e(".cancel-add").show()}}else{e("#q"+webQuiz.currentEditQid).find("div.choices");6==n?webQuiz.showAlert(lang_strings.empty_header):webQuiz.showAlert(lang_strings.empty_question)}}),e(document).on("click","#questions tr td div.preview-btn button.delete-question",function(){var t=e(this).attr("id"),i=parseInt(e(this).attr("id").substr(8,t.length-1));webQuiz.deleteQuestion(i,e("#q"+i))}),e(document).on("click","#submit-quiz",function(t){if(""!=e("#QuestionText").val()){var i=e("#questions select.choice-type-selector").val();0==webQuiz.dataValidation(i)&&webQuiz.setToPreview(webQuiz.currentEditQid,e("#q"+webQuiz.currentEditQid),function(t){webQuiz.lastEditQid=t.question_id,e("#QuizEditForm").submit()})}else e("#QuizEditForm").submit()}),e(document).on("click","#questions button.remove-choice",function(){var t=e(this).closest("tr").attr("id"),i=e(this).attr("choice"),n=e("#"+t).find("div.choices");return"q-1"==t?(e(this).closest(".well").parent().parent().remove(),void n.append('<div class="row" style="display:none;"></div>')):"q-1"!=t?(e(this).closest(".well").parent().parent().remove(),void n.append('<div class="row" style="display:none;"></div>')):void webQuiz.removeChoice(t.substr(1),i,e(this))}),e(document).on("click","#questions button.edit-done",function(t){t.preventDefault();var i=e("#questions select.choice-type-selector").val();if(7==i||8==i||""!=e("#QuestionText").val()){var n=webQuiz.dataValidation(i),o=e(this).closest("tr"),s=1;if(e("#questions > tbody  > tr:not(.others_type)").each(function(){if(e(this).index()==o.index())return!1;s++}),0==n){e(".edit-done").attr("disabled",!0),webQuiz.addNewQuestion();webQuiz.setToPreview(webQuiz.lastEditQid,e("#q"+webQuiz.lastEditQid),"test","questions/save/",s)}}else{e("#q"+webQuiz.currentEditQid).find("div.choices");6==i?webQuiz.showAlert(lang_strings.empty_header):webQuiz.showAlert(lang_strings.empty_question)}}),e(document).on("click","#show-settings",function(){e(".caret-down").toggle(),e(".caret-right").toggle(),e(".settings-options").toggle()}),e(document).on("change","#subjects-0",function(){e(".subjects").find("input").prop("checked",e(this).prop("checked"))}),e(document).on("change",".subjects input",function(){0==e(this).prop("checked")&&e("#subjects-0").prop("checked",!1),e(".subjects input:checked").length==e(".subjects input").length-1&&e("#subjects-0").prop("checked",!0)}),e(document).on("change","#classes-0",function(){e(".classes").find("input").prop("checked",e(this).prop("checked"))}),e(document).on("change",".classes input",function(){0==e(this).prop("checked")&&e("#classes-0").prop("checked",!1),e(".classes input:checked").length==e(".classes input").length-1&&e("#classes-0").prop("checked",!0)});e("#questions tbody").sortable({items:"tr:not(#q-1)",tolerance:"pointer",placeholder:"well tile",forceHelperSize:!0,helper:function(t,i){return i.children().each(function(){e(this).width(e(this).width())}),i},update:function(){webQuiz.reArrangeQuestionNumber()}}),e(document).on("click","#questions tr td div.preview-btn button.duplicate-question",function(){var t=e(this).attr("id"),i=parseInt(e(this).attr("id").substr(11,t.length-1));webQuiz.duplicateQuestion(i,e("#q"+i))}),e("#questions").on("mouseenter","tr",function(t){e(this).find(".shorter-arrow").fadeIn("slow")}),e("#questions").on("mouseleave","tr",function(t){e(this).find(".shorter-arrow").fadeOut("slow")}),e(document).on("mouseenter",".make-sortable",function(t){e(this).find(".choice-arrow").fadeIn("slow")}),e(document).on("mouseleave",".make-sortable",function(t){e(this).find(".choice-arrow").fadeOut("slow")}),e(document).on("click",".alert",function(){e(this).fadeOut("show")}),e("input.update-now").blur(function(){return("name"!=e(this).attr("name")||""!=e(this).val())&&(e(this).val()!=e(this).attr("data-current-value")&&void updateQuiz(e(this).attr("name"),e(this).val(),e(this)))}),e("input.update-now").keypress(function(t){13==t.which&&e(this).blur()}),e(document).on("click",'.settings-options input[type="checkbox"]',function(){var t,i,n=e(this);"show_result"==n.attr("name")||"anonymous"==n.attr("name")?(t=n.attr("name"),i=n.prop("checked")?1:""):"subjects[]"==n.attr("name")?(t="subjects",i=formatSubjectClass(n,"subjects")):(t="classes",i=formatSubjectClass(n,"classes")),updateQuiz(t,i)})}(jQuery),$(window).resize(function(){checkSize()});