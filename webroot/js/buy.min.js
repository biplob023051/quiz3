!function(s){function e(s){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(s)}function a(s){return/[a-zA-Z0-9]+/.test(s)}function r(e){var a;return s.ajax({dataType:"json",url:projectBaseUrl+"users/ajax_user_checking",type:"post",async:!1,data:{email:e},success:function(s){a=!(!s.success&&"true"!==s.success)}}),a}function t(){s("#package").val("29"),s("#modal-title").html(lang_strings.package_29),s("#29_package_input").prop("checked",!0),s("#29_package").removeClass("btn-yellow").addClass("btn-green"),s("#49_package").removeClass("btn-green").addClass("btn-yellow"),s("#buy-modal").modal("show")}function n(){s("#package").val("49"),s("#modal-title").html(lang_strings.package_49),s("#49_package_input").prop("checked",!0),s("#49_package").removeClass("btn-yellow").addClass("btn-green"),s("#29_package").removeClass("btn-green").addClass("btn-yellow"),s("#buy-modal").modal("show")}var i=s("#UserCreateForm"),o="";paymentFormReady=function(){return!!(i.find("[name=name]").hasClass("success")&&i.find("[name=email]").hasClass("success")&&i.find("[name=password]").hasClass("success")&&i.find("[name=passwordVerify]").hasClass("success")&&void 0!==s("input[name=payment_option]:checked").val()&&(s("#card-portion").is(":hidden")||!s("#card-portion").is(":hidden")&&i.find("[name=cardNumber]").hasClass("success")&&i.find("[name=cardExpiry]").hasClass("success")&&i.find("[name=cardCVC]").val().length>1))};var l=setInterval(function(){paymentFormReady()?s("#create-user").attr("disabled",!1):s("#create-user").attr("disabled",!0)},250);s("#name").focus(function(){s(this).removeClass("success"),s("#name-error").html("").hide()}).blur(function(){""==s(this).val()?(s(this).removeClass("success"),s("#name-error").html(lang_strings.empty_name).show()):a(s(this).val())?s(this).addClass("success"):(s(this).removeClass("success"),s("#name-error").html(lang_strings.invalid_characters).show())}),s("#email").focus(function(){s(this).removeClass("success"),s("#email-error").html("").hide()}).blur(function(){""==s(this).val()?(s(this).removeClass("success"),s("#email-error").html(lang_strings.empty_email).show()):e(s(this).val())?r(s(this).val())?s(this).addClass("success"):(s(this).removeClass("success"),s("#email-error").html(lang_strings.unique_email).show()):(s(this).removeClass("success"),s("#email-error").html(lang_strings.invalid_email).show())}),s("#password").focus(function(){s(this).removeClass("success"),s("#password-error").html("").hide()}).blur(function(){""==s(this).val()?(s(this).removeClass("success"),s("#password-error").html(lang_strings.empty_password).show()):s(this).val().length<8?(s(this).removeClass("success"),s("#password-error").html(lang_strings.character_count).show()):s(this).addClass("success")}),s("#passwordverify").focus(function(){s(this).removeClass("success"),s("#passwordverify-error").html("").hide()}).blur(function(){""==s(this).val()||s(this).val()!=s("#password").val()?(s(this).removeClass("success"),s("#passwordverify-error").html(lang_strings.varify_password).show()):s(this).addClass("success")}),s('[data-toggle="tooltip"]').tooltip(),s(document).on("click","button#buy-button-29, #29_package_input, #29_package",function(){t()}),s(document).on("click","button#buy-button-49, #49_package_input, #49_package",function(){n()}),s("input[name=payment_option]").click(function(){"card"==s(this).val()?(s("#tax-info").html(lang_strings.incl_tax),s("#card-portion").show(),s("#invoice-portion").hide()):(s("#tax-info").html(lang_strings.excl_tax),s("#invoice-portion").show(),s("#card-portion").hide()),s("#choose-payment").removeClass("text-danger")}),s("#fileuploader").html("").uploadFile({url:projectBaseUrl+"upload/photo",fileName:"myfile",allowedTypes:"jpg,png,gif,pdf,jpeg",showPreview:!1,showProgress:!1,multiple:!1,maxFileCount:1,dragDropStr:"<span class='upload-drag-drop'>"+lang_strings.drag_drop+"</span>",uploadStr:lang_strings.upload,onSuccess:function(e,a,r,t){(a=s.parseJSON(a)).success?s("#temp_photo").val(a.filename):window.location.reload()}}),s(document).on("click","#create-user",function(e){e.preventDefault(),clearInterval(l);var a=s("input[name=payment_option]:checked").val();if("card"==a){if(!validator.form())return!1;s("#create-user").html(lang_strings.validating+' <i class="fa fa-spinner fa-pulse"></i>').attr("disabled",!0),Stripe.setPublishableKey(PublishableKey);var r=i.find("[name=cardExpiry]").payment("cardExpiryVal"),t={number:i.find("[name=cardNumber]").val().replace(/\s/g,""),cvc:i.find("[name=cardCVC]").val(),exp_month:r.month,exp_year:r.year};Stripe.card.createToken(t,function(e,r){r.error?(i.find(".subscribe").html(lang_strings.retry).prop("disabled",!1),i.find(".payment-errors").text(r.error.message),i.find(".payment-errors").closest(".row").show(),card_success=!1):(s("#create-user").html(lang_strings.processing+' <i class="fa fa-spinner fa-pulse"></i>'),i.find(".payment-errors").closest(".row").hide(),i.find(".payment-errors").text(""),s.post(projectBaseUrl+"users/buyCreate",{token:r.id,package:s("#package").val(),name:s("#name").val(),email:s("#email").val(),password:s("#password").val(),passwordVerify:s("#passwordverify").val(),payment_type:a}).done(function(e,a,r){1==(e=s.parseJSON(e)).success?(o=1,s("#create-user").html(e.message+' <i class="fa fa-check"></i>'),s("#buy-modal").modal("hide"),s("#pay-title").html(lang_strings.stripe_pay_scs_title),s("#pay-body").html(lang_strings.stripe_pay_scs_body),s("#invoice-success-dialog").modal("show")):s("#create-user").html(e.message).removeClass("success").addClass("alert-danger")}).fail(function(e,a,r){s("#create-user").html(lang_strings.pay_failed).removeClass("success").addClass("error"),i.find(".payment-errors").text(lang_strings.try_refresh),i.find(".payment-errors").closest(".row").show()}))})}else s("#create-user").html(lang_strings.processing+' <i class="fa fa-spinner fa-pulse"></i>').attr("disabled",!0),s.post(projectBaseUrl+"users/buyCreate",{package:s("#package").val(),name:s("#name").val(),email:s("#email").val(),password:s("#password").val(),passwordVerify:s("#passwordverify").val(),payment_type:a,temp_photo:s("#temp_photo").val(),invoice_info:s("#invoiceInfo").val()}).done(function(e,a,r){1==(e=s.parseJSON(e)).success?(o=1,s("#create-user").html(e.message+' <i class="fa fa-check"></i>'),s("#buy-modal").modal("hide"),s("#pay-title").html(lang_strings.pay_scs_title),s("#pay-body").html(lang_strings.pay_scs_body),s("#invoice-success-dialog").modal("show")):i.find("#create-user").html(e.message).removeClass("success").addClass("alert-danger")}).fail(function(e,a,r){s("#create-user").html(lang_strings.pay_failed).removeClass("success").addClass("error"),i.find(".payment-errors").text(lang_strings.try_refresh),i.find(".payment-errors").closest(".row").show()})}),s("#invoice-success-dialog").on("hidden.bs.modal",function(){""!=o?window.location=projectBaseUrl:window.location.reload()}),s("input[name=cardNumber]").payment("formatCardNumber"),s("input[name=cardCVC]").payment("formatCardCVC"),s("input[name=cardExpiry").payment("formatCardExpiry"),jQuery.validator.addMethod("cardNumber",function(s,e){return this.optional(e)||Stripe.card.validateCardNumber(s)},lang_strings.invalid_card),jQuery.validator.addMethod("cardExpiry",function(e,a){return e=s.payment.cardExpiryVal(e),this.optional(a)||Stripe.card.validateExpiry(e.month,e.year)},lang_strings.invalid_expire),jQuery.validator.addMethod("cardCVC",function(s,e){return this.optional(e)||Stripe.card.validateCVC(s)},lang_strings.invalid_cvc),s.extend(s.validator.messages,{required:lang_strings.required_field}),validator=i.validate({rules:{cardNumber:{required:!0,cardNumber:!0},cardExpiry:{required:!0,cardExpiry:!0},cardCVC:{required:!0,cardCVC:!0},email:{required:!1}},highlight:function(e){s(e).closest(".form-control").removeClass("success").addClass("error")},unhighlight:function(e){s(e).closest(".form-control").removeClass("error").addClass("success")},errorPlacement:function(e,a){s(a).closest(".form-group").append(e)}})}(jQuery);