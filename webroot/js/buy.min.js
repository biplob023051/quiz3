!function(s){var e=s("#UserCreateForm"),a="";paymentFormReady=function(){return!!(e.find("[name=name]").hasClass("success")&&e.find("[name=email]").hasClass("success")&&e.find("[name=password]").hasClass("success")&&e.find("[name=passwordVerify]").hasClass("success")&&void 0!==s("input[name=payment_option]:checked").val()&&(s("#card-portion").is(":hidden")||!s("#card-portion").is(":hidden")&&s("#cardNumberId").hasClass("success")&&s("#cardExpireId").hasClass("success")&&s("#cardCvcId").val().length>1))};var r=setInterval(function(){paymentFormReady()?s("#create-user").attr("disabled",!1):s("#create-user").attr("disabled",!0)},250);s("#name").focus(function(){s(this).removeClass("success"),s("#name-error").html("").hide()}).blur(function(){var e;""==s(this).val()?(s(this).removeClass("success"),s("#name-error").html(lang_strings.empty_name).show()):(e=s(this).val(),/[a-zA-Z0-9]+/.test(e)?s(this).addClass("success"):(s(this).removeClass("success"),s("#name-error").html(lang_strings.invalid_characters).show()))}),s("#email").focus(function(){s(this).removeClass("success"),s("#email-error").html("").hide()}).blur(function(){var e,a,r;""==s(this).val()?(s(this).removeClass("success"),s("#email-error").html(lang_strings.empty_email).show()):(r=s(this).val(),/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(r)?(e=s(this).val(),s.ajax({dataType:"json",url:projectBaseUrl+"users/ajax_user_checking",type:"post",async:!1,data:{email:e},success:function(s){a=!(!s.success&&"true"!==s.success)}}),a?s(this).addClass("success"):(s(this).removeClass("success"),s("#email-error").html(lang_strings.unique_email).show())):(s(this).removeClass("success"),s("#email-error").html(lang_strings.invalid_email).show()))}),s("#password").focus(function(){s(this).removeClass("success"),s("#password-error").html("").hide()}).blur(function(){""==s(this).val()?(s(this).removeClass("success"),s("#password-error").html(lang_strings.empty_password).show()):s(this).val().length<8?(s(this).removeClass("success"),s("#password-error").html(lang_strings.character_count).show()):s(this).addClass("success")}),s("#passwordverify").focus(function(){s(this).removeClass("success"),s("#passwordverify-error").html("").hide()}).blur(function(){""==s(this).val()||s(this).val()!=s("#password").val()?(s(this).removeClass("success"),s("#passwordverify-error").html(lang_strings.varify_password).show()):s(this).addClass("success")}),s('[data-toggle="tooltip"]').tooltip(),s(document).on("click","button#buy-button-29, #29_package_input, #29_package",function(){s("#package").val("29"),s("#modal-title").html(lang_strings.package_29),s("#29_package_input").prop("checked",!0),s("#29_package").removeClass("btn-yellow").addClass("btn-green"),s("#49_package").removeClass("btn-green").addClass("btn-yellow"),s("#buy-modal").modal("show")}),s(document).on("click","button#buy-button-49, #49_package_input, #49_package",function(){s("#package").val("49"),s("#modal-title").html(lang_strings.package_49),s("#49_package_input").prop("checked",!0),s("#49_package").removeClass("btn-yellow").addClass("btn-green"),s("#29_package").removeClass("btn-green").addClass("btn-yellow"),s("#buy-modal").modal("show")}),s("input[name=payment_option]").click(function(){"card"==s(this).val()?(s("#tax-info").html(lang_strings.incl_tax),s("#card-portion").show(),s("#invoice-portion").hide()):(s("#tax-info").html(lang_strings.excl_tax),s("#invoice-portion").show(),s("#card-portion").hide()),s("#choose-payment").removeClass("text-danger")}),s("#fileuploader").html("").uploadFile({url:projectBaseUrl+"upload/photo",fileName:"myfile",allowedTypes:"jpg,png,gif,pdf,jpeg",showPreview:!1,showProgress:!1,multiple:!1,maxFileCount:1,dragDropStr:"<span class='upload-drag-drop'>"+lang_strings.drag_drop+"</span>",uploadStr:lang_strings.upload,onSuccess:function(e,a,r,t){(a=s.parseJSON(a)).success?s("#temp_photo").val(a.filename):window.location.reload()}}),s(document).on("click","#create-user",function(t){t.preventDefault(),clearInterval(r);var i=s("input[name=payment_option]:checked").val();if("card"==i){if(!validator.form())return!1;s("#create-user").html(lang_strings.validating+' <i class="fa fa-spinner fa-pulse"></i>').attr("disabled",!0),Stripe.setPublishableKey(PublishableKey);var l=s("#cardExpireId").payment("cardExpiryVal"),o={number:s("#cardNumberId").val().replace(/\s/g,""),cvc:s("#cardCvcId").val(),exp_month:l.month,exp_year:l.year};Stripe.card.createToken(o,function(r,t){t.error?(e.find(".subscribe").html(lang_strings.retry).prop("disabled",!1),e.find(".payment-errors").text(t.error.message),e.find(".payment-errors").closest(".row").show(),card_success=!1):(s("#create-user").html(lang_strings.processing+' <i class="fa fa-spinner fa-pulse"></i>'),e.find(".payment-errors").closest(".row").hide(),e.find(".payment-errors").text(""),s.post(projectBaseUrl+"users/buyCreate",{token:t.id,package:s("#package").val(),name:s("#name").val(),email:s("#email").val(),password:s("#password").val(),passwordVerify:s("#passwordverify").val(),payment_type:i}).done(function(e,r,t){1==(e=s.parseJSON(e)).success?(a=e.success_url,s("#create-user").html(e.message+' <i class="fa fa-check"></i>'),s("#buy-modal").modal("hide"),s("#pay-title").html(lang_strings.stripe_pay_scs_title),s("#pay-body").html(lang_strings.stripe_pay_scs_body),s("#invoice-success-dialog").modal("show")):s("#create-user").html(e.message).removeClass("success").addClass("alert-danger")}).fail(function(a,r,t){s("#create-user").html(lang_strings.pay_failed).removeClass("success").addClass("error"),e.find(".payment-errors").text(lang_strings.try_refresh),e.find(".payment-errors").closest(".row").show()}))})}else s("#create-user").html(lang_strings.processing+' <i class="fa fa-spinner fa-pulse"></i>').attr("disabled",!0),s.post(projectBaseUrl+"users/buyCreate",{package:s("#package").val(),name:s("#name").val(),email:s("#email").val(),password:s("#password").val(),passwordVerify:s("#passwordverify").val(),payment_type:i,temp_photo:s("#temp_photo").val(),invoice_info:s("#invoiceInfo").val()}).done(function(r,t,i){1==(r=s.parseJSON(r)).success?(a=r.success_url,s("#create-user").html(r.message+' <i class="fa fa-check"></i>'),s("#buy-modal").modal("hide"),s("#pay-title").html(lang_strings.pay_scs_title),s("#pay-body").html(lang_strings.pay_scs_body),s("#invoice-success-dialog").modal("show")):e.find("#create-user").html(r.message).removeClass("success").addClass("alert-danger")}).fail(function(a,r,t){s("#create-user").html(lang_strings.pay_failed).removeClass("success").addClass("error"),e.find(".payment-errors").text(lang_strings.try_refresh),e.find(".payment-errors").closest(".row").show()})}),s("#invoice-success-dialog").on("hidden.bs.modal",function(){""!=a?window.location=projectBaseUrl+"users/"+a:window.location.reload()}),s("#cardNumberId").payment("formatCardNumber"),s("#cardCvcId").payment("formatCardCVC"),s("#cardExpireId").payment("formatCardExpiry"),jQuery.validator.addMethod("cardNumber",function(s,e){return this.optional(e)||Stripe.card.validateCardNumber(s)},lang_strings.invalid_card),jQuery.validator.addMethod("cardExpiry",function(e,a){return e=s.payment.cardExpiryVal(e),this.optional(a)||Stripe.card.validateExpiry(e.month,e.year)},lang_strings.invalid_expire),jQuery.validator.addMethod("cardCVC",function(s,e){return this.optional(e)||Stripe.card.validateCVC(s)},lang_strings.invalid_cvc),s.extend(s.validator.messages,{required:lang_strings.required_field}),validator=e.validate({rules:{cardNumber:{required:!0,cardNumber:!0},cardExpiry:{required:!0,cardExpiry:!0},cardCVC:{required:!0,cardCVC:!0},email:{required:!1}},highlight:function(e){s(e).closest(".form-control").removeClass("success").addClass("error")},unhighlight:function(e){s(e).closest(".form-control").removeClass("error").addClass("success")},errorPlacement:function(e,a){s(a).closest(".form-group").append(e)}})}(jQuery);